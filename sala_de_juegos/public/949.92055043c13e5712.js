"use strict";(self.webpackChunksala_de_juegos=self.webpackChunksala_de_juegos||[]).push([[949],{7949:(U,u,r)=>{r.r(u),r.d(u,{ChatModule:()=>F});var l=r(6895),c=r(433),f=r(1469),h=r(6881),g=r(5861),t=r(4650),m=r(3288),a=r(4102),p=r(3900),C=r(4004),M=r(7246);let v=(()=>{class n{constructor(e,o){this.firestore=e,this.auth=o,this.auth.onAuthStateChanged(s=>{null!=s&&(this.currentUser=s)})}addChatMessage(e,o){const s=(0,a.hJ)(this.firestore,"messages");return(0,a.ET)(s,{msg:e,from:this.currentUser.uid,sendAt:(0,a.Bt)(),name:o})}getChatMessages(){let e=[];return this.getUsers().pipe((0,p.w)(o=>{e=o;const s=(0,a.hJ)(this.firestore,"messages");return(0,a.BS)(s,{idField:"uid"})}),(0,C.U)(o=>{for(let s of o)null!=s.from&&(s.fromName=this.getUserForMsg(s.from,e),s.myMsg=this.currentUser.uid===s.from);return console.log("all messages",o),o}))}getUsers(){const e=(0,a.hJ)(this.firestore,"users");return(0,a.BS)(e,{idField:"uid"})}getUserForMsg(e,o){for(let s of o)if(s.uid==e)return s.email;return"Eliminado"}}return n.\u0275fac=function(e){return new(e||n)(t.LFG(a.gg),t.LFG(M.gx))},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var x=r(3252);const _=["containerMsg"];function y(n,i){if(1&n&&(t.TgZ(0,"div")(1,"b"),t._uU(2),t.qZA()()),2&n){const e=t.oxw().$implicit;t.xp6(2),t.Oqu(e.name)}}function b(n,i){if(1&n&&(t.TgZ(0,"div",15),t.YNc(1,y,3,1,"div",16),t.TgZ(2,"span"),t._uU(3),t.qZA(),t.TgZ(4,"div",17),t._UZ(5,"br"),t._uU(6),t.ALo(7,"date"),t.qZA()()),2&n){const e=i.$implicit,o=t.oxw(2);t.Q6J("ngClass",e.from==o.user.uid?"enviado":"recibido"),t.xp6(1),t.Q6J("ngIf",e.name!=o.user.name),t.xp6(2),t.hij(" ",e.msg," "),t.xp6(3),t.hij("",t.xi3(7,4,null==e.sendAt?null:e.sendAt.toMillis(),"short")," ")}}const T=function(){return{standalone:!0}};function w(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4),t._uU(4," CHAT "),t.qZA(),t.TgZ(5,"div",5,6)(7,"div"),t.YNc(8,b,8,7,"div",7),t.qZA()(),t.TgZ(9,"form",8),t.NdJ("ngSubmit",function(){t.CHM(e);const s=t.oxw();return t.KtG(s.sendMessage())}),t.TgZ(10,"div",9)(11,"input",10),t.NdJ("ngModelChange",function(s){t.CHM(e);const d=t.oxw();return t.KtG(d.newMessage=s)}),t.qZA(),t.TgZ(12,"div",11)(13,"span",12),t.O4$(),t.TgZ(14,"svg",13),t.NdJ("click",function(){t.CHM(e);const s=t.oxw();return t.KtG(s.sendMessage())}),t._UZ(15,"path",14),t.qZA()()()()()()()()}if(2&n){const e=t.MAs(6),o=t.oxw();t.xp6(5),t.Q6J("scrollTop",e.scrollHeight),t.xp6(3),t.Q6J("ngForOf",o.messages),t.xp6(3),t.Q6J("ngModel",o.newMessage)("ngModelOptions",t.DdM(4,T))}}const O=[{path:"",component:(()=>{class n{constructor(e,o){this.auth=e,this.chat=o,this.messages=[],this.user={}}ngOnInit(){this.auth.userData.subscribe(e=>{this.user=e,console.info("user chat",this.user)})}ngAfterViewInit(){this.getMessages()}sendMessage(){var e=this;return(0,g.Z)(function*(){console.log(e.newMessage),e.messages?.push(),e.chat.addChatMessage(e.newMessage,e.user.name).then(()=>{setTimeout(()=>{},100)}),e.newMessage=""})()}getMessages(){var e=this;return(0,g.Z)(function*(){const o=e.chat.getChatMessages();e.suscripcion=o.subscribe(function(){var s=(0,g.Z)(function*(d){e.messages=d.sort((A,J)=>A.sendAt.seconds-J.sendAt.seconds),e.newMessage&&(yield e.sendMessage(),e.scrollToBottom(),e.newMessage=""),e.scrollToBottom()});return function(d){return s.apply(this,arguments)}}())})()}scrollToBottom(){try{setTimeout(()=>{let e=this.scroll?.nativeElement.querySelector("#scrollMe");null!=e&&(e.scrollTop=e.scrollHeight)},50)}catch(e){console.log("err",e)}}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(m.e),t.Y36(v))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-chat"]],viewQuery:function(e,o){if(1&e&&t.Gf(_,5),2&e){let s;t.iGM(s=t.CRH())&&(o.scroll=s.first)}},decls:2,vars:1,consts:[["class","container",4,"ngIf"],[1,"container"],[1,"row"],[1,"card","mt-3","col-6","offset-3","blur-in","cardContainer"],[1,"card-header"],[1,"containerMsg","h-100",2,"overflow","scroll","height","xyz",3,"scrollTop"],["scrollMe",""],["class","message p-2 mt-2",3,"ngClass",4,"ngFor","ngForOf"],[1,"card-footer","text-muted",3,"ngSubmit"],[1,"input-group","mb-3"],["type","text","placeholder","Ingrese su mensaje",1,"form-control",3,"ngModel","ngModelOptions","ngModelChange"],[1,"input-group-append"],["id","basic-addon2",1,"input-group-text"],["xmlns","http://www.w3.org/2000/svg","height","25px","viewBox","0 0 512 512","width","25px",1,"iconSend",3,"click"],["d","M16.1 260.2c-22.6 12.9-20.5 47.3 3.6 57.3L160 376V479.3c0 18.1 14.6 32.7 32.7 32.7c9.7 0 18.9-4.3 25.1-11.8l62-74.3 123.9 51.6c18.9 7.9 40.8-4.5 43.9-24.7l64-416c1.9-12.1-3.4-24.3-13.5-31.2s-23.3-7.5-34-1.4l-448 256zm52.1 25.5L409.7 90.6 190.1 336l1.2 1L68.2 285.7zM403.3 425.4L236.7 355.9 450.8 116.6 403.3 425.4z"],[1,"message","p-2","mt-2",3,"ngClass"],[4,"ngIf"],[1,"mt-0",2,"color","rgba(255, 255, 255, 0.925)","font-size","12px"]],template:function(e,o){1&e&&(t._UZ(0,"app-navbar"),t.YNc(1,w,16,5,"div",0)),2&e&&(t.xp6(1),t.Q6J("ngIf",o.user))},dependencies:[l.mk,l.sg,l.O5,c._Y,c.Fj,c.JJ,c.JL,c.On,c.F,x.S,l.uU],styles:[".cardContainer[_ngcontent-%COMP%]{width:500px;height:450px}.card-header[_ngcontent-%COMP%]{background-color:#1a1b1ddc;color:#fff;font-weight:700}.card-body[_ngcontent-%COMP%]{padding:.5rem}.iconSend[_ngcontent-%COMP%]:active{transform:scale(.8)}.card[_ngcontent-%COMP%]{text-align:center;background:#FC466B;background:linear-gradient(to right,#3F5EFB,#FC466B);opacity:.94;border-radius:10px;border-style:groove;box-shadow:10px 5px 5px #a51515cc;color:#fff}.blur-in[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_blur-in 1s linear both}@keyframes _ngcontent-%COMP%_blur-in{0%{filter:blur(12px);opacity:0}to{filter:blur(0);opacity:.94}}.card-img-top[_ngcontent-%COMP%]{display:block;width:60%;margin:auto;opacity:1}.link[_ngcontent-%COMP%]{color:#e7e5e5;font-size:24px}.enviado[_ngcontent-%COMP%]{display:block;float:right;background-color:#3f5efbda;color:#fff;min-width:50.01%;text-align:left}.recibido[_ngcontent-%COMP%]{display:block;float:left;background-color:#fc466ada;min-width:50.01%;text-align:left}.message[_ngcontent-%COMP%]{color:#fff;border-radius:12px}.containerMsg[_ngcontent-%COMP%]{overflow:scroll;padding:.3rem}.containerMsg[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}"]}),n})()}];let Z=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[h.Bz.forChild(O),h.Bz]}),n})(),F=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[l.ez,c.u5,f.m,Z]}),n})()}}]);